> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

OpenAI API key is configured
5:18:11 PM [express] serving on port 5000
Browserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#read5:18:19 PM [express] GET /api/auth/me 304 in 41ms :: {"user":{"id":91,"username":"strong","displayNa…
5:18:25 PM [express] GET /api/auth/me 304 in 39ms :: {"user":{"id":91,"username":"strong","displayNa…
5:18:31 PM [express] POST /api/auth/login 200 in 181ms :: {"user":{"id":91,"username":"strong","disp…
5:18:31 PM [express] GET /api/contacts 304 in 155ms :: {"contacts":[{"id":55,"userId":91,"contactUse…
5:18:32 PM [express] GET /api/chat-rooms 304 in 711ms :: {"chatRooms":[{"id":86,"name":"하이 테스트","isG…
5:18:32 PM [express] GET /api/chat-rooms/86/messages 304 in 41ms :: {"messages":[{"id":360,"chatRoom…
5:18:32 PM [express] GET /api/chat-rooms/85/messages 304 in 38ms :: {"messages":[]}
5:18:32 PM [express] GET /api/chat-rooms/84/messages 304 in 38ms :: {"messages":[]}
5:18:32 PM [express] GET /api/chat-rooms/83/messages 304 in 43ms :: {"messages":[{"id":343,"chatRoom…
5:18:32 PM [express] GET /api/chat-rooms/69/messages 304 in 39ms :: {"messages":[]}
5:18:32 PM [express] GET /api/unread-counts 200 in 1359ms :: {"unreadCounts":[]}
5:18:33 PM [express] GET /api/person-folders 304 in 43ms :: [{"id":42,"userId":91,"contactId":97,"pe…
Fetching folder items for folderId: 42
5:18:34 PM [express] GET /api/person-folders 304 in 40ms :: [{"id":42,"userId":91,"contactId":97,"pe…
Found folder items: 1 [
  {
    id: 15,
    folderId: 42,
    itemType: 'business_card',
    fileName: 'business-card-91-1749748388351.jpg',
    fileUrl: '/uploads/business-cards/business-card-91-1749748388351.jpg',
    fileSize: 117650,
    mimeType: 'image/jpeg',
    title: 'Stan Lee님의 명함',
    description: 'CB Engineering Managing Director',
    tags: [ 'CB Engineering', 'Managing Director' ],
    businessCardData: '{"name":"Stan Lee","company":"CB Engineering","jobTitle":"Managing Director","email":"hello2sagyun@gmail.com","phone":"+36 70 356 6830","address":"H-2900 Komárom, Bánki Donát u. 4.","isRegisteredUser":true,"registeredUserId":91,"registeredUserDisplayName":"이상윤","canSendDM":true}',
    chatRoomId: null,
    messageId: null,
    createdAt: 2025-06-12T17:13:08.665Z,
    updatedAt: 2025-06-12T17:13:08.665Z
  }
]
5:18:34 PM [express] GET /api/person-folders/42/items 304 in 42ms :: [{"id":15,"folderId":42,"itemTy…
5:18:39 PM [express] GET /api/unread-counts 304 in 1244ms :: {"unreadCounts":[]}
5:18:40 PM [express] DELETE /api/person-folders/42 200 in 77ms :: {"success":true}
5:18:40 PM [express] GET /api/person-folders 200 in 39ms :: []
5:18:40 PM [express] GET /api/person-folders 200 in 39ms :: []
Processing business card image: IMG_3155.jpg 154936 bytes
Starting business card analysis with OpenAI Vision API
OpenAI Response: {
  "id": "chatcmpl-Bhfre3pbLOPNAP0ZfsiTPpAiWMsus",
  "object": "chat.completion",
  "created": 1749748730,
  "model": "gpt-4o-2024-08-06",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "{\n  \"name\": \"STAN LEE\",\n  \"company\": \"CB Engineering\",\n  \"jobTitle\": \"Managing director\",\n  \"email\": \"hello2sagyn@gmail.com\",\n  \"phone\": \"+36 70 356 66 30\",\n  \"address\": \"H-2900 Komárom, Bánki Donát u. 4.\"\n}",
        "refusal": null,
        "annotations": []
      },
      "logprobs": null,
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 524,
    "completion_tokens": 80,
    "total_tokens": 604,
    "prompt_tokens_details": {
      "cached_tokens": 0,
      "audio_tokens": 0
    },
    "completion_tokens_details": {
      "reasoning_tokens": 0,
      "audio_tokens": 0,
      "accepted_prediction_tokens": 0,
      "rejected_prediction_tokens": 0
    }
  },
  "service_tier": "default",
  "system_fingerprint": "fp_a288987b44"
}
Business card analysis completed successfully: {
  name: 'STAN LEE',
  company: 'CB Engineering',
  jobTitle: 'Managing director',
  email: 'hello2sagyn@gmail.com',
  phone: '+36 70 356 66 30',
  address: 'H-2900 Komárom, Bánki Donát u. 4.'
}
createPersonFolder called with: { userId: 91, contactId: 99, folderName: 'STAN LEE' }
Executing direct pool query: 
        INSERT INTO person_folders (user_id, contact_id, person_name, folder_name, last_activity, item_count, created_at, updated_at)
        VALUES ($1, $2, $3, $4, NOW(), 0, NOW(), NOW())
        RETURNING *
      
With values: [ 91, 99, 'STAN LEE', 'STAN LEE' ]
Created folder: {
  id: 44,
  user_id: 91,
  contact_id: 99,
  person_name: 'STAN LEE',
  created_at: 2025-06-12T17:18:53.174Z,
  updated_at: 2025-06-12T17:18:53.174Z,
  folder_name: 'STAN LEE',
  avatar_url: null,
  last_activity: 2025-06-12T17:18:53.174Z,
  item_count: 0
}
Business card verification result: {
  isRegistered: true,
  userId: 91,
  userName: '이상윤',
  imageStored: '/uploads/business-cards/business-card-91-1749748732947.jpg'
}
5:18:53 PM [express] POST /api/scan-business-card 200 in 4243ms :: {"name":"STAN LEE","company":"CB …
POST /api/contacts - Request body: {
  name: 'STAN LEE',
  company: 'CB Engineering',
  jobTitle: 'Managing director',
  email: 'hello2sagyn@gmail.com',
  phone: '+36 70 356 66 30',
  address: 'H-2900 Komárom, Bánki Donát u. 4.'
}
POST /api/contacts - User ID from header: 91
Creating external contact from business card data
Creating external contact with data: {
  userId: 91,
  contactUserId: null,
  nickname: 'STAN LEE',
  name: 'STAN LEE',
  email: 'hello2sagyn@gmail.com',
  phone: '+36 70 356 66 30',
  company: 'CB Engineering',
  jobTitle: 'Managing director',
  notes: undefined
}
External contact created successfully: {
  id: 100,
  userId: 91,
  contactUserId: null,
  nickname: 'STAN LEE',
  name: 'STAN LEE',
  email: 'hello2sagyn@gmail.com',
  phone: '+36 70 356 66 30',
  company: 'CB Engineering',
  jobTitle: 'Managing director',
  notes: null,
  isPinned: false,
  isFavorite: false,
  isBlocked: false,
  createdAt: 2025-06-12T17:18:54.899Z
}
5:18:54 PM [express] POST /api/contacts 200 in 46ms :: {"contact":{"id":100,"userId":91,"contactUser…
createPersonFolder called with: { userId: 91, contactId: 100, folderName: 'STAN LEE' }
Executing direct pool query: 
        INSERT INTO person_folders (user_id, contact_id, person_name, folder_name, last_activity, item_count, created_at, updated_at)
        VALUES ($1, $2, $3, $4, NOW(), 0, NOW(), NOW())
        RETURNING *
      
With values: [ 91, 100, 'STAN LEE', 'STAN LEE' ]
Created folder: {
  id: 45,
  user_id: 91,
  contact_id: 100,
  person_name: 'STAN LEE',
  created_at: 2025-06-12T17:18:55.066Z,
  updated_at: 2025-06-12T17:18:55.066Z,
  folder_name: 'STAN LEE',
  avatar_url: null,
  last_activity: 2025-06-12T17:18:55.066Z,
  item_count: 0
}
5:18:55 PM [express] POST /api/person-folders 200 in 39ms :: {"id":45,"user_id":91,"contact_id":100,…
Creating folder item with data: {
  "itemType": "business_card",
  "title": "STAN LEE님의 명함",
  "description": "CB Engineering Managing director",
  "tags": [
    "CB Engineering",
    "Managing director"
  ],
  "businessCardData": "{\"name\":\"STAN LEE\",\"company\":\"CB Engineering\",\"jobTitle\":\"Managing director\",\"email\":\"hello2sagyn@gmail.com\",\"phone\":\"+36 70 356 66 30\",\"address\":\"H-2900 Komárom, Bánki Donát u. 4.\",\"isRegisteredUser\":true,\"registeredUserId\":91,\"registeredUserDisplayName\":\"이상윤\",\"canSendDM\":true,\"imageUrl\":\"/uploads/business-cards/business-card-91-1749748732947.jpg\",\"folderId\":44,\"folderItemId\":17}",
  "folderId": 45
}
folderId from params: 45
req.body: {
  "itemType": "business_card",
  "title": "STAN LEE님의 명함",
  "description": "CB Engineering Managing director",
  "tags": [
    "CB Engineering",
    "Managing director"
  ],
  "businessCardData": "{\"name\":\"STAN LEE\",\"company\":\"CB Engineering\",\"jobTitle\":\"Managing director\",\"email\":\"hello2sagyn@gmail.com\",\"phone\":\"+36 70 356 66 30\",\"address\":\"H-2900 Komárom, Bánki Donát u. 4.\",\"isRegisteredUser\":true,\"registeredUserId\":91,\"registeredUserDisplayName\":\"이상윤\",\"canSendDM\":true,\"imageUrl\":\"/uploads/business-cards/business-card-91-1749748732947.jpg\",\"folderId\":44,\"folderItemId\":17}"
}
5:18:55 PM [express] POST /api/person-folders/45/items 200 in 153ms :: {"id":18,"folderId":45,"itemT…
5:18:56 PM [express] GET /api/contacts 200 in 41ms :: {"contacts":[{"id":55,"userId":91,"contactUser…
5:18:56 PM [express] GET /api/person-folders 200 in 159ms :: [{"id":45,"userId":91,"contactId":100,"…
5:18:57 PM [express] GET /api/auth/me 304 in 38ms :: {"user":{"id":91,"username":"strong","displayNa…
5:19:02 PM [express] GET /api/auth/me 200 in 38ms :: {"user":{"id":91,"username":"strong","displayNa…
5:19:02 PM [express] GET /api/contacts 304 in 38ms :: {"contacts":[{"id":55,"userId":91,"contactUser…
5:19:03 PM [express] GET /api/chat-rooms 200 in 742ms :: {"chatRooms":[{"id":86,"name":"하이 테스트","isG…
5:19:03 PM [express] GET /api/chat-rooms/86/messages 304 in 39ms :: {"messages":[{"id":360,"chatRoom…
5:19:04 PM [express] GET /api/chat-rooms/85/messages 304 in 39ms :: {"messages":[]}
5:19:04 PM [express] GET /api/person-folders 304 in 40ms :: [{"id":45,"userId":91,"contactId":100,"p…
5:19:04 PM [express] GET /api/unread-counts 304 in 1247ms :: {"unreadCounts":[]}
5:19:04 PM [express] GET /api/chat-rooms/84/messages 304 in 40ms :: {"messages":[]}
5:19:04 PM [express] GET /api/chat-rooms/83/messages 304 in 42ms :: {"messages":[{"id":343,"chatRoom…
5:19:04 PM [express] GET /api/chat-rooms/69/messages 304 in 41ms :: {"messages":[]}
Fetching folder items for folderId: 44
Found folder items: 1 [
  {
    id: 17,
    folderId: 44,
    itemType: 'business_card',
    fileName: 'business-card-91-1749748732947.jpg',
    fileUrl: '/uploads/business-cards/business-card-91-1749748732947.jpg',
    fileSize: 117650,
    mimeType: 'image/jpeg',
    title: 'STAN LEE님의 명함',
    description: 'CB Engineering Managing director',
    tags: [ 'CB Engineering', 'Managing director' ],
    businessCardData: '{"name":"STAN LEE","company":"CB Engineering","jobTitle":"Managing director","email":"hello2sagyn@gmail.com","phone":"+36 70 356 66 30","address":"H-2900 Komárom, Bánki Donát u. 4.","isRegisteredUser":true,"registeredUserId":91,"registeredUserDisplayName":"이상윤","canSendDM":true}',
    chatRoomId: null,
    messageId: null,
    createdAt: 2025-06-12T17:18:53.327Z,
    updatedAt: 2025-06-12T17:18:53.327Z
  }
]
5:19:05 PM [express] GET /api/person-folders/44/items 200 in 40ms :: [{"id":17,"folderId":44,"itemTy…
5:19:05 PM [express] GET /api/person-folders 304 in 41ms :: [{"id":45,"userId":91,"contactId":100,"p…
5:19:10 PM [express] GET /api/unread-counts 304 in 1223ms :: {"unreadCounts":[]}
5:19:19 PM [express] GET /api/auth/me 304 in 37ms :: {"user":{"id":91,"username":"strong","displayNa…
5:19:50 PM [express] GET /api/auth/me 304 in 175ms :: {"user":{"id":91,"username":"strong","displayN…
5:20:21 PM [express] GET /api/auth/me 304 in 163ms :: {"user":{"id":91,"username":"strong","displayN…
5:20:52 PM [express] GET /api/auth/me 304 in 168ms :: {"user":{"id":91,"username":"strong","displayN…
5:21:08 PM [express] GET /api/auth/me 304 in 39ms :: {"user":{"id":91,"username":"strong","displayNa…
5:21:11 PM [express] POST /api/auth/login 200 in 180ms :: {"user":{"id":91,"username":"strong","disp…
5:21:11 PM [express] GET /api/contacts 304 in 41ms :: {"contacts":[{"id":55,"userId":91,"contactUser…
5:21:12 PM [express] GET /api/chat-rooms 200 in 681ms :: {"chatRooms":[{"id":86,"name":"하이 테스트","isG…
5:21:12 PM [express] GET /api/chat-rooms/86/messages 304 in 38ms :: {"messages":[{"id":360,"chatRoom…
5:21:12 PM [express] GET /api/chat-rooms/85/messages 304 in 38ms :: {"messages":[]}
5:21:12 PM [express] GET /api/chat-rooms/84/messages 304 in 38ms :: {"messages":[]}
5:21:13 PM [express] GET /api/chat-rooms/83/messages 304 in 40ms :: {"messages":[{"id":343,"chatRoom…
5:21:13 PM [express] GET /api/unread-counts 304 in 1330ms :: {"unreadCounts":[]}
5:21:13 PM [express] GET /api/chat-rooms/69/messages 304 in 40ms :: {"messages":[]}
5:21:19 PM [express] GET /api/person-folders 304 in 38ms :: [{"id":45,"userId":91,"contactId":100,"p…
5:21:19 PM [express] GET /api/unread-counts 304 in 1228ms :: {"unreadCounts":[]}
Fetching folder items for folderId: 44
Found folder items: 1 [
  {
    id: 17,
    folderId: 44,
    itemType: 'business_card',
    fileName: 'business-card-91-1749748732947.jpg',
    fileUrl: '/uploads/business-cards/business-card-91-1749748732947.jpg',
    fileSize: 117650,
    mimeType: 'image/jpeg',
    title: 'STAN LEE님의 명함',
    description: 'CB Engineering Managing director',
    tags: [ 'CB Engineering', 'Managing director' ],
    businessCardData: '{"name":"STAN LEE","company":"CB Engineering","jobTitle":"Managing director","email":"hello2sagyn@gmail.com","phone":"+36 70 356 66 30","address":"H-2900 Komárom, Bánki Donát u. 4.","isRegisteredUser":true,"registeredUserId":91,"registeredUserDisplayName":"이상윤","canSendDM":true}',
    chatRoomId: null,
    messageId: null,
    createdAt: 2025-06-12T17:18:53.327Z,
    updatedAt: 2025-06-12T17:18:53.327Z
  }
]
5:21:20 PM [express] GET /api/person-folders/44/items 304 in 38ms :: [{"id":17,"folderId":44,"itemTy…
5:21:20 PM [express] GET /api/person-folders 304 in 38ms :: [{"id":45,"userId":91,"contactId":100,"p…
5:21:52 PM [express] GET