<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=yes" />
    <title>Dovie Messenger - ìŠ¤ë§ˆíŠ¸ ë©”ì‹ ì €</title>
    <meta name="description" content="ìŠ¤ë§ˆíŠ¸ íŒŒì¼ ê´€ë¦¬ì™€ ì‹¤ì‹œê°„ ì±„íŒ…ì´ ê°€ëŠ¥í•œ ë©”ì‹ ì € ì•±" />
    <meta name="keywords" content="ë©”ì‹ ì €, ì±„íŒ…, íŒŒì¼ê³µìœ , í•´ì‹œíƒœê·¸, ìŠ¤ë§ˆíŠ¸ì±„íŒ…, Dovie" />
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#7c3aed" />
    <meta name="background-color" content="#7c3aed" />
    <meta name="application-name" content="Dovie Messenger" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Dovie" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="msapplication-TileColor" content="#7c3aed" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-72x72.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192x192.png" />
    <link rel="mask-icon" href="/icons/icon-192x192.png" color="#7c3aed" />
    
    <!-- Open Graph -->
    <meta property="og:title" content="Dovie Messenger - ìŠ¤ë§ˆíŠ¸ ë©”ì‹ ì €" />
    <meta property="og:description" content="ìŠ¤ë§ˆíŠ¸ íŒŒì¼ ê´€ë¦¬ì™€ ì‹¤ì‹œê°„ ì±„íŒ…ì´ ê°€ëŠ¥í•œ ë©”ì‹ ì € ì•±" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/icons/icon-512x512.png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Dovie Messenger" />
    <meta name="twitter:description" content="ìŠ¤ë§ˆíŠ¸ íŒŒì¼ ê´€ë¦¬ì™€ ì‹¤ì‹œê°„ ì±„íŒ…ì´ ê°€ëŠ¥í•œ ë©”ì‹ ì € ì•±" />
    <meta name="twitter:image" content="/icons/icon-512x512.png" />
    
    <!-- Preload critical resources -->
    <link rel="preload" href="/src/main.tsx" as="script" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- PWA Service Worker ê°•ì œ ë“±ë¡ ì‹œìŠ¤í…œ -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async function() {
          try {
            console.log('ğŸš€ PWA Service Worker ê°•ì œ ë“±ë¡ ì‹œì‘...');
            
            // Clear all existing registrations to prevent conflicts
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (const registration of registrations) {
              await registration.unregister();
              console.log('ğŸ”„ Clearing existing Service Worker');
            }
            
            // Clear all caches to prevent authentication issues
            const cacheNames = await caches.keys();
            for (const cacheName of cacheNames) {
              await caches.delete(cacheName);
              console.log('ğŸ—‘ï¸ Cleared cache:', cacheName);
            }
            
            // iOS 16+ ê°ì§€ ë° ìµœì  Service Worker ì„ íƒ
            const isIOSDevice = /iPhone|iPad|iPod/.test(navigator.userAgent);
            const isIOS16Plus = isIOSDevice && (
              /OS 1[6-9]/.test(navigator.userAgent) || 
              /OS [2-9][0-9]/.test(navigator.userAgent) ||
              /Version\/1[6-9]/.test(navigator.userAgent) ||
              /Version\/[2-9][0-9]/.test(navigator.userAgent)
            );
            const isPWAMode = window.navigator.standalone === true || 
                            window.matchMedia('(display-mode: standalone)').matches;
            
            let swFile = '/sw.js'; // ê¸°ë³¸
            if (isIOSDevice && isIOS16Plus && isPWAMode) {
              swFile = '/sw-ios16-enhanced.js'; // iOS 16+ PWA ê°•í™”
            } else if (isIOSDevice) {
              swFile = '/sw-ios16.js'; // iOS ê¸°ë³¸
            }
            
            console.log('ğŸ” ë””ë°”ì´ìŠ¤ ì •ë³´:', {
              isIOSDevice,
              isIOS16Plus,
              isPWAMode,
              swFile,
              userAgent: navigator.userAgent
            });
            
            // ìƒˆë¡œìš´ Service Worker ë“±ë¡
            const registration = await navigator.serviceWorker.register(swFile, {
              scope: '/',
              updateViaCache: 'none',
              type: 'classic'
            });
            
            console.log('âœ… PWA Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
            
            // Service Worker ì¤€ë¹„ ëŒ€ê¸°
            await navigator.serviceWorker.ready;
            console.log('âœ… PWA Service Worker ì¤€ë¹„ ì™„ë£Œ');
            
            // ì¦‰ì‹œ ì•Œë¦¼ ê¶Œí•œ í™•ì¸
            if ('Notification' in window) {
              console.log('ğŸ”” í˜„ì¬ ì•Œë¦¼ ê¶Œí•œ:', Notification.permission);
            }
            
          } catch (err) {
            console.error('âŒ PWA Service Worker ë“±ë¡ ì‹¤íŒ¨:', err);
          }
        });
        
        // Handle PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', function(e) {
          console.log('[PWA] Install prompt triggered');
          e.preventDefault();
          deferredPrompt = e;
          
          // Show custom install button (will be handled in React app)
          window.dispatchEvent(new CustomEvent('pwa-install-available'));
        });
        
        // Track successful app installation
        window.addEventListener('appinstalled', function(e) {
          console.log('[PWA] App successfully installed');
          deferredPrompt = null;
        });
      }
    </script>
    
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>