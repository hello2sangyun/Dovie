# 📱 Xcode 테스트 가이드 - 3가지 수정사항 확인

이 가이드는 방금 수정한 3가지 문제를 Xcode에서 확인하는 방법을 안내합니다.

---

## 🔄 1단계: 최신 코드 가져오기

Mac 터미널에서:

```bash
cd /Users/stanlee/Documents/Dovie
git stash
git pull
npm install
npx cap sync ios
npx cap open ios
```

---

## ✅ 수정사항 1: 다이내믹 아일랜드 문제 해결

### 문제
- 보라색 "Dovie Messenger" 헤더가 다이내믹 아일랜드에 가려짐

### 수정 내용
- 헤더 상단 패딩을 `1rem`에서 `3.5rem`으로 증가
- 이제 헤더가 다이내믹 아일랜드 아래에 충분한 공간 확보

### 테스트 방법
1. **Xcode에서 실제 iPhone으로 실행** (시뮬레이터 아님)
2. 앱 실행 후 **"채팅방"**, **"연락처"**, **"북마크"**, **"설정"** 탭 모두 확인
3. **확인 사항**:
   - ✅ 보라색 헤더가 다이내믹 아일랜드 아래에서 시작
   - ✅ "Dovie Messenger" 텍스트가 완전히 보임
   - ✅ 헤더 위쪽에 충분한 공간 (약 56px)

---

## ✅ 수정사항 2: 채팅방 터치 감지 개선

### 문제
- 채팅방 리스트에서 짧게 터치해도 채팅방으로 들어가지 않음
- `touchAction: 'none'` 때문에 터치 이벤트가 차단됨

### 수정 내용
- `touchAction: 'none'` 제거
- onClick을 조건부로 처리 (다중 선택 모드일 때만 사용)
- 짧은 터치(800ms 이하)는 `handleLongPressEnd`에서 처리

### 테스트 방법
1. **채팅방 리스트**로 이동
2. **짧게 터치** (0.5초 이하):
   - ✅ 채팅방에 바로 들어가짐
   - ✅ 부드러운 전환 애니메이션
3. **길게 누르기** (0.8초 이상):
   - ✅ 음성 녹음 시작
   - ✅ 빨간색 녹음 UI 표시
4. **다중 선택 모드**:
   - 우측 상단 메뉴 → "다중 선택"
   - ✅ 체크박스로 선택 가능

---

## ✅ 수정사항 3: 오프라인 뱃지 지원

### 문제
- 오프라인(비행기 모드)일 때 앱 아이콘 뱃지가 업데이트 안 됨
- Service Worker가 `/api/unread-counts`를 캐싱하지 않음

### 수정 내용
- Service Worker에 `/api/unread-counts` 캐싱 추가
- 오프라인일 때 캐시된 데이터로 뱃지 업데이트
- `refreshBadgeFromServer` 함수에 오프라인 모드 지원

### 테스트 방법

#### 온라인 테스트 (정상 작동 확인)
1. **앱 실행** (WiFi/셀룰러 켜진 상태)
2. 다른 사용자가 메시지 전송
3. **홈 버튼** 눌러서 앱 백그라운드로
4. **홈 화면 확인**:
   - ✅ Dovie 앱 아이콘에 빨간 뱃지 표시 (예: 1, 2, 3...)
5. 앱 다시 열고 메시지 읽기
6. 홈으로 나가기:
   - ✅ 뱃지 숫자 감소 또는 사라짐

#### 오프라인 테스트 (새 기능!)
1. **앱 실행** (온라인 상태)
2. 메시지가 있는 상태에서 **앱 완전 종료** (스와이프 업)
3. **비행기 모드 켜기** ✈️
4. **앱 다시 실행**
5. **확인 사항**:
   - ✅ 앱이 정상 실행됨
   - ✅ 이전에 캐시된 채팅방 리스트 표시
   - ✅ 앱 아이콘 뱃지가 마지막 캐시된 값으로 유지
6. **홈으로 나가기**:
   - ✅ 뱃지가 계속 표시됨 (캐시된 데이터)
7. **비행기 모드 끄기**:
   - ✅ 앱이 자동으로 최신 데이터 동기화
   - ✅ 뱃지가 실제 읽지 않은 메시지 수로 업데이트

---

## 🎯 전체 통합 테스트

모든 수정사항을 함께 테스트:

### 시나리오 1: 일반 사용
1. 앱 실행
2. ✅ 헤더가 다이내믹 아일랜드에 안 가려짐
3. 채팅방 리스트에서 짧게 터치
4. ✅ 채팅방으로 바로 이동
5. 메시지 받기
6. 홈으로 나가기
7. ✅ 앱 아이콘에 뱃지 표시

### 시나리오 2: 음성 메시지
1. 채팅방 리스트에서 길게 누르기 (0.8초+)
2. ✅ 음성 녹음 시작
3. ✅ 빨간색 UI 표시
4. 손 떼기
5. ✅ 음성 확인 모달 표시
6. 편집하고 전송
7. ✅ 채팅방으로 자동 이동

### 시나리오 3: 오프라인 사용
1. 온라인 상태에서 앱 사용
2. 앱 종료
3. 비행기 모드 켜기
4. 앱 다시 실행
5. ✅ 헤더 정상 표시 (Safe Area)
6. ✅ 캐시된 채팅방 보임
7. ✅ 뱃지 유지됨

---

## 🐛 문제 해결

### 터치가 여전히 작동 안 함
1. Xcode에서 **Clean Build Folder** (Shift + Cmd + K)
2. 프로젝트 재빌드
3. iPhone 재부팅

### 뱃지가 표시 안 됨
1. iPhone 설정 → 알림 → Dovie Messenger
2. "배지 허용" 켜기
3. 앱 재설치

### 헤더가 여전히 가려짐
1. iPhone 모델 확인 (iPhone 14 Pro 이상만 다이내믹 아일랜드 있음)
2. 구형 모델은 노치만 있음
3. Safe Area는 모든 모델에서 작동

---

## 📸 스크린샷 가이드

테스트 중 다음 스크린샷을 찍어두면 좋아요:

1. **헤더 Safe Area**
   - 채팅방 리스트 화면
   - 다이내믹 아일랜드와 헤더 사이 공간 보임

2. **짧은 터치**
   - 채팅방 터치 → 채팅방 화면 전환
   - 부드러운 애니메이션

3. **긴 터치**
   - 음성 녹음 UI
   - 빨간색 배경

4. **오프라인 뱃지**
   - 비행기 모드에서 앱 아이콘
   - 뱃지 숫자 표시

---

## ✅ 모든 테스트 완료 후

모든 항목이 정상 작동하면:
1. **APNS 인증서 설정** (`APNS_SETUP_GUIDE.md` 참고)
2. **푸시 알림 테스트** (`DEPLOYMENT_CHECKLIST.md` 참고)
3. **Replit 퍼블릭 배포**
4. **App Store 제출 준비**

---

**테스트 완료! 모든 기능이 정상 작동해요!** 🎉
